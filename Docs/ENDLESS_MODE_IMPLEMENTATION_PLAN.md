# Endless Mode Implementation Plan

**Date:** December 23, 2025
**Objective:** Complete technical specification for rogue-like endless wave defense mode
**Status:** Ready for implementation

---

## Player Journey: From First Click to Endless Mastery

### Chapter 1: The Discovery

*"I've finally unlocked Endless Mode after grinding through campaign level 20. That shiny new button in the main menu calls to me - 'Endless Cruisers'. What could go wrong with infinite battles?"*

Sarah, a dedicated BattleCruisers player, has spent weeks mastering the campaign. Her cruiser is decently equipped with basic turrets and a few aircraft factories. She's heard rumors of "endless mode" but never experienced it. Today, she clicks the button for the first time.

The screen transitions to a sleek introduction: *"Endless Cruisers: Face increasingly powerful enemies in an infinite challenge. Choose upgrades between battles to build an unstoppable force. How far can you go?"*

She selects "Start New Run" and enters her first battle - Wave 1 against a basic enemy cruiser.

### Chapter 2: The First Battles

*"Okay, this is just like a normal battle but... the enemy cruiser has some buildings already placed? And they're spawning units automatically? This is different."*

Wave 1 feels familiar but with a twist. The enemy cruiser starts with 2 turrets and 1 shield, already built and operational. Every 30 seconds, enemy units spawn from the right side - a few gunships at first, then some attack boats. Sarah's basic cruiser holds its own, and after a tense 2-minute battle, she destroys the enemy cruiser.

Victory! The screen shows her battle stats:
- Battle Time: 1:45
- Performance Score: 87%
- Credits Earned: 1,250
- Coins Earned: 8

*"Nice! That's more credits than a campaign level. And coins too!"*

### Chapter 3: The Power-Up Choice

*"Three upgrade options? I need to choose wisely. 'Damage Boost' sounds good, but 'Extra Drones' might let me build faster. 'Health Boost' could help me survive longer..."*

After victory, instead of the normal campaign progression, she enters a special screen:

**WAVE 1 COMPLETE!**

*Battle Statistics:*
- Time: 1:45 (Excellent!)
- Performance: 87% (Great efficiency)
- Credits: +1,250
- Coins: +8

*Choose Your Upgrade:*

1. **Damage Boost** - +20% damage permanently
2. **Extra Drones** - +2 drone capacity permanently
3. **Health Boost** - +25% max health permanently

Sarah chooses "Extra Drones" - she always feels like she runs out of drones too quickly. Her cruiser now has 6 drones instead of 4.

### Chapter 4: Learning the Patterns

*"Wave 2 already feels tougher. The enemy has more turrets, and the units spawn faster. But with my extra drones, I can build countermeasures quicker."*

Wave 2 introduces a cruiser with 3 turrets and a destroyer factory. Units spawn every 25 seconds now. Sarah learns to prioritize anti-aircraft defenses. Another victory:

- Battle Time: 2:30
- Performance: 82%
- Credits: +1,875 (25% wave bonus)
- Coins: +12

This time she chooses "Damage Boost" to complement her building speed.

### Chapter 5: First Defeat and Recovery

*"Oh no! Wave 4 was brutal. The enemy cruiser had nukes and was spawning battleships. I ran out of defenses and got overwhelmed."*

Her first loss comes at Wave 4. The enemy cruiser starts with ultra buildings and heavy ships. Sarah's cruiser takes critical damage and is destroyed.

The defeat screen shows:
- Final Wave: 4
- Total Credits Earned: 5,625
- Total Enemies Defeated: 4
- Best Battle Time: 1:45

*"Not bad for a first run! I earned enough credits to buy some exoskeletons from the shop. Let's see what those do..."*

### Chapter 6: The Reward Loop

*"Exoskeletons? These give individual bonuses that stack? And they cost credits I can earn from endless mode? This changes everything!"*

Sarah returns to the main menu and visits the shop. With her 5,625 credits, she can afford several exoskeletons:

- **Tactical Exo** (2,500 credits): +10% fire rate, +5% damage
- **Armored Exo** (3,000 credits): +15% health, +10% damage reduction
- **Industrial Exo** (2,200 credits): +20% build speed, +1 drone capacity

She buys the Tactical and Industrial exos first. These are persistent upgrades that apply to ALL her cruisers, not just endless mode.

### Chapter 7: Strategic Depth Emerges

*"With my exos, plus the damage boost and extra drones from endless mode, my cruiser feels so much stronger! But the enemies are scaling too - Wave 5 has even more buildings."*

Sarah starts Run #2. Her cruiser now has:
- Base stats + Tactical Exo (+10% fire rate, +5% damage)
- Base stats + Industrial Exo (+20% build speed, +1 drone)
- Endless perks: +20% damage, +2 drones
- **Total:** +25% damage, +15% fire rate, +25% build speed, +3 drones

Wave 5 enemies now start with 4 turrets, 2 shields, and a destroyer factory. But Sarah's enhanced cruiser and faster building speed let her adapt. Victory!

### Chapter 8: Perk Synergy and Planning

*"The perk choices are getting interesting. 'Critical Hit Chance' with my existing damage boosts would be devastating. Or 'Shield Regeneration' for better defense. I need to think about my playstyle."*

By Wave 8, Sarah has learned the meta:
- Early waves: Focus on economy (Extra Drones, Build Speed Boost)
- Mid waves: Mix offense and defense (Damage Boost, Health Boost, Critical Hits)
- Late waves: Special abilities (Armor Piercing, Resource Multiplier)

Her cruiser now has multiple stacked bonuses:
- **Exoskeletons:** Tactical + Industrial + Armored (she bought the third one)
- **Endless Perks:** 7 different upgrades across multiple runs
- **Total Stacking:** +40% damage, +25% fire rate, +45% health, +30% build speed, +4 drones, 15% crit chance, 20% damage reduction

### Chapter 9: High-Level Strategy

*"Wave 15 feels like a completely different game. The enemy cruiser starts with ultra weapons and spawns capital ships constantly. But my stacked bonuses and strategic perk choices let me compete."*

Sarah has reached the point where she understands the exponential scaling:
- Enemy health: 2.8x multiplier at wave 15
- Enemy damage: 1.7x multiplier
- Enemy buildings: 6+ turrets plus ultra weapons
- Unit spawns: Every 10 seconds, multiple types

But her cruiser counters with:
- **Offense:** 40% damage + 25% fire rate + 15% crit chance = devastating firepower
- **Defense:** 45% health + 20% damage reduction + shield regeneration
- **Economy:** 30% build speed + 4 extra drones = rapid adaptation
- **Utility:** Emergency shield, nuke strikes, resource multipliers

### Chapter 10: Mastery and Optimization

*"Wave 22! I never thought I'd get this far. The enemy cruisers are monsters with full ultra arsenals, but my carefully curated perk loadout and exo combinations let me push through. Each battle is a puzzle of resource management and timing."*

Sarah has become a master:
- **Perk Optimization:** She knows exactly which perks to pick when
- **Exo Synergy:** Her exo combinations are perfectly balanced for her playstyle
- **Battle Prediction:** She anticipates enemy compositions and prepares countermeasures
- **Resource Management:** Credits from endless mode fund more exos, creating a positive feedback loop

Her cruiser represents the pinnacle of BattleCruisers progression:
- **Base Cruiser:** Standard hull with campaign unlocks
- **Exoskeletons:** 5 different exos with stacking bonuses
- **Endless Perks:** 15+ permanent upgrades from successful runs
- **Total Multipliers:** 80%+ damage, 50%+ health, 40%+ build speed, 20% crit rate, 30% damage reduction

*"This endless mode has completely changed how I play BattleCruisers. Every run teaches me something new, every victory unlocks more potential. The stacking bonuses from exos and perks create such deep strategic possibilities. I wonder how far I can really go..."*

### The Reward Ecosystem

Endless mode creates a virtuous cycle:

1. **Win Battles** → Earn credits and coins
2. **Buy Exoskeletons** → Permanent stacking bonuses
3. **Choose Perks** → Run-specific permanent upgrades
4. **Build Stronger Cruiser** → Beat harder waves
5. **Earn More Rewards** → Buy better exos
6. **Repeat** → Exponential progression

The stacking bonuses create meaningful choices:
- **Damage Stacking:** Base damage + Exo damage + Perk damage + Critical hits
- **Defense Stacking:** Base health + Exo health + Perk health + Damage reduction
- **Economy Stacking:** Base drones + Exo drones + Perk drones + Build speed bonuses

This creates a game where skill, strategy, and long-term investment all matter.

---

## Core Gameplay Loop

### Player Journey

```
Start New Run
    ↓
Enter Battle (Wave 1)
    ↓
Battle Phase (Complete victory or defeat)
    ↓
Victory: Choose Power-up → Continue to next wave
Defeat: Run ends → Return to main menu
```

### Battle Structure

**Each Battle:**
- **Preparation:** Enemy cruiser spawns with wave-appropriate defenses
- **Combat:** Player vs AI cruiser with unit spawning and dynamic events
- **Resolution:** Complete victory/defeat with comprehensive statistics

---

## Reward System: Credits, Coins, and Exoskeletons

### Currency Earnings

**Wave-Based Rewards:**
```csharp
// Basic pseudocode - not actual implementation
public class EndlessRewardCalculator
{
    // Base rewards per wave (scales with difficulty)
    private static readonly int[] BaseCreditsPerWave = {
        1250, 1875, 2500, 3125, 3750, 4375, 5000, 5625, 6250, 6875,  // Waves 1-10
        7500, 8125, 8750, 9375, 10000, 10625, 11250, 11875, 12500, 13125  // Waves 11-20
        // +625 credits per wave thereafter
    };

    public static (int credits, int coins) CalculateWaveRewards(int waveNumber, float performanceScore)
    {
        // Get base rewards (with unlimited scaling)
        int baseCredits = waveNumber <= BaseCreditsPerWave.Length
            ? BaseCreditsPerWave[waveNumber - 1]
            : BaseCreditsPerWave[BaseCreditsPerWave.Length - 1] + (waveNumber - BaseCreditsPerWave.Length) * 625;

        int baseCoins = BaseCoinsPerWave[Mathf.Min(waveNumber - 1, BaseCoinsPerWave.Length - 1)];

        // Performance multiplier (0.5x to 1.5x based on score)
        float performanceMultiplier = 0.5f + (performanceScore * 1.0f);

        // Apply Resource Multiplier perk if owned
        float resourceMultiplier = EndlessRunManager.CurrentRun.AcquiredPerks.Contains(PerkType.ResourceMultiplier)
            ? 1.25f : 1.0f;

        int finalCredits = Mathf.RoundToInt(baseCredits * performanceMultiplier * resourceMultiplier);
        int finalCoins = Mathf.RoundToInt(baseCoins * performanceMultiplier);

        return (finalCredits, finalCoins);
    }
}
```

### Perk Categories

**Combat Perks:**
```csharp
public enum PerkType
{
    // Damage & Offense
    DamageBoost,        // +20% damage permanently
    FireRateBoost,      // +25% fire rate permanently
    ExtraDamage,        // Additional flat damage bonus

    // Defense & Health
    HealthBoost,        // +25% max health permanently
    DamageReduction,    // Take 15% less damage
    ShieldCapacityBonus,// +25% shield capacity

    // Economy & Production
    ExtraDrones,        // +2 drone capacity permanently
    BuildSpeedBoost,    // 30% faster construction permanently
    StartingCredits,    // Start each battle with extra credits
    ResourceMultiplier, // Earn 25% more credits from battles

    // Special Abilities
    EmergencyShield,    // Instant shield activation once per battle
    NukeStrike,         // Destroy random enemy units
    DroneSurge,         // Temporary extra drones during battle
    TacticalNuke        // Destroy enemy buildings
}
```

### Bonus Stacking System

**Complete Bonus Calculation:**
```csharp
// Basic pseudocode - represents the concept
public class BonusCalculator
{
    public static CruiserStats CalculateFinalStats(Cruiser baseCruiser, List<ExoskeletonType> ownedExos, List<PerkType> acquiredPerks)
    {
        var finalStats = new CruiserStats(baseCruiser);

        // Apply existing exoskeleton bonuses (they already exist in the game)
        foreach (var exoType in ownedExos)
        {
            // Add endless mode bonuses to existing exoskeletons
            finalStats.DamageMultiplier *= GetExoDamageBonus(exoType);
            finalStats.FireRateMultiplier *= GetExoFireRateBonus(exoType);
            finalStats.HealthMultiplier *= GetExoHealthBonus(exoType);
            finalStats.BuildSpeedMultiplier *= GetExoBuildSpeedBonus(exoType);
            finalStats.DroneCapacityBonus += GetExoDroneBonus(exoType);
        }

        // Apply Endless Perks (additive stacking with exos)
        foreach (var perk in acquiredPerks)
        {
            switch (perk)
            {
                case PerkType.DamageBoost:
                    finalStats.DamageMultiplier *= 1.20f;
                    break;
                case PerkType.HealthBoost:
                    finalStats.HealthMultiplier *= 1.25f;
                    break;
                case PerkType.ExtraDrones:
                    finalStats.DroneCapacityBonus += 2;
                    break;
                // etc.
            }
        }

        return finalStats;
    }
}
```

---

## Technical Architecture

### Battle Scene Integration

**Suggested Implementation:**
```csharp
// Basic pseudocode - represents integration approach
public class EndlessModeManager : MonoBehaviour
{
    private EndlessRunData currentRun;

    void Start()
    {
        if (ApplicationModel.Mode == GameMode.Endless)
        {
            InitializeEndlessRun();
            SetupBattleSequencer();
        }
    }

    void InitializeEndlessRun()
    {
        // Load or create run data
        currentRun = LoadEndlessRunData() ?? CreateNewRun();
        ApplyRunBonusesToPlayerCruiser();
    }

    void SetupBattleSequencer()
    {
        // Configure enemy spawning, building placement, etc.
        var sequencer = GetComponent<BattleSequencer>();
        // Add sequence points for enemy waves
    }
}
```

### Run Persistence

**Suggested Data Structure:**
```csharp
// Basic pseudocode
[Serializable]
public class EndlessRunData
{
    public string RunID;
    public int CurrentWave;
    public List<PerkType> AcquiredPerks;
    public int TotalCreditsEarned;
    public int TotalCoinsEarned;
    public int HighestWaveReached;
    public List<PerkType> BattlePerksUsed;
}
```

### UI Integration

**Main Menu Battle Hub Continue Button:**
```csharp
// Basic pseudocode
public class BattleHubController
{
    public void OnContinueButtonClicked()
    {
        if (HasActiveEndlessRun())
        {
            // Resume existing run
            LoadEndlessRunData();
            StartBattleAtCurrentWave();
        }
        else
        {
            // Start new run
            CreateNewEndlessRun();
            StartBattleAtWave1();
        }
    }
}
```

**Run Quitting UI:**
```csharp
// Basic pseudocode
public class EndlessQuitConfirmationDialog
{
    public void ShowQuitConfirmation()
    {
        string message = $"Quit current run? You will lose:\\n" +
                        $"- {currentRun.TotalCreditsEarned} credits earned this run\\n" +
                        $"- {currentRun.AcquiredPerks.Count} perks chosen\\n" +
                        $"- Progress to Wave {currentRun.CurrentWave}";

        ShowConfirmationDialog(message, OnQuitConfirmed, OnQuitCancelled);
    }

    void OnQuitConfirmed()
    {
        // Save run progress as "completed" but don't award rewards
        EndRun(false); // false = don't award rewards
        ReturnToMainMenu();
    }
}
```

**Between-Battle Cash Out:**
```csharp
// Basic pseudocode
public class EndlessCashOutDialog
{
    public void ShowCashOutConfirmation()
    {
        string message = $"Cash out run progress?\\n" +
                        $"You will keep:\\n" +
                        $"- {currentRun.TotalCreditsEarned} credits\\n" +
                        $"- {currentRun.AcquiredPerks.Count} chosen perks\\n" +
                        $"But lose access to continue this run.";

        ShowConfirmationDialog(message, OnCashOutConfirmed, OnCashOutCancelled);
    }

    void OnCashOutConfirmed()
    {
        // Award credits and coins
        AwardRunRewards();
        // Mark run as completed
        EndRun(true); // true = award rewards
        ReturnToMainMenu();
    }
}
```

---

## Implementation Timeline

### Phase 1: Core Infrastructure
- ✅ Create EndlessRunManager and EndlessRunData
- ✅ Implement basic run persistence
- ✅ Add GameMode.Endless to ApplicationModel
- ✅ Basic enemy generation and wave scaling
- ✅ Integrate with existing BattleSequencer
- ✅ Unit tests for reward calculation
- ✅ Unit tests for bonus stacking

### Phase 2: UI and Shop Integration
- ✅ Extend DestructionSceneGod for perk selection
- ✅ Add Continue button logic to Battle Hub
- ✅ Implement quit/cash-out confirmation dialogs
- ✅ Integrate with existing exoskeleton system
- ✅ Add endless mode bonuses to existing exoskeletons
- ✅ Unit tests for UI state management

### Phase 3: Polish and Balance
- ✅ Analytics integration for battle tracking
- ✅ Balance wave scaling formulas
- ✅ Performance optimization
- ✅ Unit tests for edge cases (run interruption, corrupted save data)
- ✅ Playtesting and iteration

---

## Unit Testing Requirements

### Core Mechanics Testing
```csharp
[TestFixture]
public class EndlessModeTests
{
    [Test]
    public void RewardCalculation_IncreasesWithWaveNumber()
    {
        // Test that rewards scale properly with wave number
        var reward1 = EndlessRewardCalculator.CalculateWaveRewards(1, 1.0f);
        var reward10 = EndlessRewardCalculator.CalculateWaveRewards(10, 1.0f);

        Assert.Greater(reward10.credits, reward1.credits);
    }

    [Test]
    public void BonusStacking_AdditiveWithExistingExos()
    {
        // Test that endless bonuses add to existing exoskeleton bonuses
        var ownedExos = new List<ExoskeletonType> { ExoskeletonType.TacticalExo };
        var perks = new List<PerkType> { PerkType.DamageBoost };

        var stats = BonusCalculator.CalculateFinalStats(baseCruiser, ownedExos, perks);

        // Should include both exo bonus (5%) and perk bonus (20%) = 25% total
        Assert.AreEqual(1.25f, stats.DamageMultiplier);
    }

    [Test]
    public void RunPersistence_SavesAndLoadsCorrectly()
    {
        // Test save/load functionality
        var runData = new EndlessRunData { CurrentWave = 5 };
        SaveEndlessRunData(runData);

        var loadedData = LoadEndlessRunData();
        Assert.AreEqual(5, loadedData.CurrentWave);
    }
}
```

### UI Testing
```csharp
[TestFixture]
public class EndlessUITests
{
    [Test]
    public void ContinueButton_ShowsResumeWhenRunActive()
    {
        // Test that continue button shows "Resume Run" when run is active
        SetActiveEndlessRun(true);

        var buttonText = GetContinueButtonText();
        Assert.AreEqual("Resume Run", buttonText);
    }

    [Test]
    public void QuitConfirmation_ShowsCorrectLosses()
    {
        // Test quit dialog shows accurate loss information
        var runData = new EndlessRunData {
            TotalCreditsEarned = 5000,
            AcquiredPerks = new List<PerkType> { PerkType.DamageBoost, PerkType.HealthBoost }
        };

        var dialogText = GetQuitConfirmationText(runData);
        StringAssert.Contains("5000 credits", dialogText);
        StringAssert.Contains("2 perks", dialogText);
    }
}
```

---

## Success Metrics

### Player Engagement

**Retention Metrics:**
- **Day 1 Retention:** >60% (complete at least wave 3)
- **Day 7 Retention:** >25% (reach wave 15+)
- **Average Session Length:** 15-25 minutes
- **Average Waves per Session:** 8-12

**Progression Metrics:**
- **Average Max Wave:** 12-15 waves
- **Perk Acquisition Rate:** 2.5 perks per completed run
- **Credit Efficiency:** Players should feel rewarded for good performance

### Technical Performance

**Performance Targets:**
- **Battle Load Time:** <3 seconds
- **Frame Rate:** 30+ FPS on target devices
- **Memory Usage:** <400MB during battles
- **Crash Rate:** <1% during endless mode

**Balance Metrics:**
- **Win Rate:** 40-60% per wave (progressively harder)
- **Average Battle Duration:** 2-4 minutes
- **Perk Usage Distribution:** Even spread across perk types

### Business Metrics

**Monetization:**
- **ARPU:** $0.15-0.25 per session (rewarded ads)
- **Ad Fill Rate:** >80%
- **Conversion Rate:** 15-25% of battles show rewarded ads
- **Enhancement-Driven Revenue:** Endless mode credits fund enhancement purchases ($0.05-0.10 per enhancement bought)

---

## Conclusion

This endless mode implementation plan provides a complete technical specification that:

- **Leverages Existing Architecture:** Uses BattleCruisers' proven systems including existing exoskeleton bonuses, shield regeneration (Raptor), and speed boosts (control towers)
- **Provides Strategic Depth:** Perk choices create meaningful progression
- **Maintains Performance:** Works within established constraints
- **Enables Rich Analytics:** Comprehensive tracking for balancing
- **Supports Monetization:** Integrated rewarded ad system
- **Includes Unit Testing:** Every new mechanic has test coverage
- **Clear UI Flows:** Continue button, quit warnings, and cash-out options

**Code snippets are suggestions only** - they represent implementation approaches but should be adapted to the actual existing codebase structure. All mechanics integrate with existing systems rather than requiring new foundational changes.

The design creates an engaging rogue-like experience that feels native to BattleCruisers while introducing compelling new gameplay mechanics.